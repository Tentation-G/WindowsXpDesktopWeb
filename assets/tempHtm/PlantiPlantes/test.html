<div class="home-container">

    <div class="card-lil-wrapper1">
        <?php foreach ($products as $product): ?>
        <div class="product-card">
            <img src="assets/images/<?php echo $product['image']; ?>" alt="Produit" class="product-image">
            <div class="product-details">
                <h2 class="product-title">
                    <?php echo $product['name']; ?>
                </h2>
                <p class="product-description">
                    <?php echo $product['description']; ?>
                </p>
                <p class="product-price">€
                    <?php echo number_format($product['price'], 2); ?>
                </p>
                <button class="product-button">Ajouter au panier</button>
            </div>
        </div>
        <?php endforeach; ?>
    </div>

    <div class="card-lil-wrapper2">
        <div class="product-card2">
            <img src="assets/images/rose" alt="Produit" class="product-image">
            <div class="product-details">
                <h2 class="product-title">Titre du Produit</h2>
                <p class="product-description">Lorem ipsum dolor sit amet consectetur adipisicing elit. Quia, natus.</p>
                <p class="product-price">€19.99</p>
                <button class="product-button">Ajouter au panier</button>
            </div>
        </div>
        <div class="product-card">
            <img src="assets/images/fleurRose" alt="Produit" class="product-image">
            <div class="product-details">
                <h2 class="product-title">Titre du Produit</h2>
                <p class="product-description">Lorem, ipsum dolor sit amet consectetur adipisicing elit. Cum, ut?</p>
                <p class="product-price">€19.99</p>
                <button class="product-button">Ajouter au panier</button>
            </div>
        </div>
    </div>

    <div class="card-lil-wrapper3">
        <div class="product-card">
            <img src="assets/images/fleur1" alt="Produit" class="product-image">
            <div class="product-details">
                <h2 class="product-title">Titre du Produit</h2>
                <p class="product-description">Lorem, ipsum dolor sit amet consectetur adipisicing elit. Cum, ut?</p>
                <p class="product-price">€19.99</p>
                <button class="product-button">Ajouter au panier</button>
            </div>
        </div>
        <div class="product-card2">
            <img src="assets/images/rose" alt="Produit" class="product-image">
            <div class="product-details">
                <h2 class="product-title">Titre du Produit</h2>
                <p class="product-description">Lorem ipsum dolor sit amet consectetur adipisicing elit. Quia, natus.</p>
                <p class="product-price">€19.99</p>
                <button class="product-button">Ajouter au panier</button>
            </div>
        </div>
    </div>

    <div class="card-lil-wrapper1">
        <div class="product-card">
            <img src="assets/images/tableBasse" alt="Produit" class="product-image">
            <div class="product-details">
                <h2 class="product-title">Titre du Produit</h2>
                <p class="product-description">Lorem ipsum dolor sit amet consectetur adipisicing elit. Quia, natus.</p>
                <p class="product-price">€19.99</p>
                <button class="product-button">Ajouter au panier</button>
            </div>
        </div>
        <div class="product-card">
            <img src="assets/images/veloNoir" alt="Produit" class="product-image">
            <div class="product-details">
                <h2 class="product-title">Titre du Produit</h2>
                <p class="product-description">Lorem ipsum dolor sit amet consectetur adipisicing elit. Aut, sed!</p>
                <p class="product-price">€19.99</p>
                <button class="product-button">Ajouter au panier</button>
            </div>
        </div>
        <div class="product-card">
            <img src="assets/images/table" alt="Produit" class="product-image">
            <div class="product-details">
                <h2 class="product-title">Titre du Produit</h2>
                <p class="product-description">Lorem, ipsum dolor sit amet consectetur adipisicing elit. Cum, ut?</p>
                <p class="product-price">€19.99</p>
                <button class="product-button">Ajouter au panier</button>
            </div>
        </div>
    </div>

</div>

<?php ob_start(); //Commence l'enregistrement 

?>
<div class="container">

    <!-- User Part -->
    <?php //include ('views\admin\userBO.php'); ?>
    <div class="container u-container">

        <h1 class="center">Gestion des Utilisateurs</h1>

        <!-- Affichage des utilisateurs -->
        <h3>Liste des Utilisateurs</h3>
        <div class="user-card-container">
            <?php
            $users = getAllUsers();
            foreach ($users as $user): 
                if(isset($user['id_role'])){
                    switch ($user['id_role']) {
                        case '1':
                                $userRoleBorder = 'admin';
                            break;
                        case '2':
                                $userRoleBorder = 'mod';
                            break;
                        case '3':
                                $userRoleBorder = 'user';
                            break;
                        default:
                
                            break;
                    }
                }
            ?>
            <div class="user-card-wrapper <?= $userRoleBorder ?>">
                <h2>
                    <?= $user['id'] ?>
                </h2>
                <div class="user-icon-wrapper">
                    <svg fill="currentColor" width="120px" height="120px" viewBox="0 0 128 128" id="Layer_1"
                        version="1.1" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
                        xmlns:xlink="http://www.w3.org/1999/xlink">
                        <g>
                            <path
                                d="M30,49c0,18.7,15.3,34,34,34s34-15.3,34-34S82.7,15,64,15S30,30.3,30,49z M90,49c0,14.3-11.7,26-26,26S38,63.3,38,49   s11.7-26,26-26S90,34.7,90,49z" />
                            <path
                                d="M24.4,119.4C35,108.8,49,103,64,103s29,5.8,39.6,16.4l5.7-5.7C97.2,101.7,81.1,95,64,95s-33.2,6.7-45.3,18.7L24.4,119.4z" />
                        </g>
                    </svg>
                </div>
                <div class="user-content">
                    <h2 class="user-name">
                        <?= $user['nom']?>
                        <?=$user['prenom']?>
                    </h2>
                    <p class="user-email">
                        <?= $user['email'] ?>
                    </p>
                    <p class="user-tel">
                        <?= $user['tel'] ?>
                    </p>
                </div>
            </div>
            <?php endforeach; ?>
        </div>

        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Email</th>
                        <th>Nom</th>
                        <th>Prénom</th>
                        <th>Téléphone</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <?php
                    $users = getAllUsers();
                    foreach ($users as $user): ?>
                    <tr>
                        <td>
                            <?= $user['id'] ?>
                        </td>
                        <td>
                            <?= $user['email'] ?>
                        </td>
                        <td>
                            <?= $user['nom'] ?>
                        </td>
                        <td>
                            <?= $user['prenom'] ?>
                        </td>
                        <td>
                            <?= $user['tel'] ?>
                        </td>
                        <td>
                            <a href="update_user.php?id=<?= $user['id'] ?>" class="btn-action btn-mod">Modifier</a>

                            <a href="<?= URL; ?>controllers/userCrud/deleteUser.php?id=<?= $user['id'] ?>"
                                class="btn-action btn-supp">Supprimer</a>

                        </td>
                    </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>

        <!-- Log des connexions -->
        <h3>Logs des Utilisateurs</h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Utilisateur</th>
                        <th>Action</th>
                        <th>Date et Heure</th>
                    </tr>
                </thead>
                <tbody>
                    <?php 
                    $logs = afficherLogs();
                    foreach ($logs as $log): ?>
                    <tr>
                        <td>
                            <?= $log['id'] ?>
                        </td>
                        <td>
                            <?= $log['nom'] . ' ' . $log['prenom'] ?>
                        </td>
                        <td class="<?= $log['action'] === 'connexion' ? 'connexion-color' : 'deconnexion-color' ?>">
                            <?= htmlspecialchars($log['action']) ?>
                        </td>
                        <td>
                            <?= htmlspecialchars($log['timestamp']) ?>
                        </td>
                    </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Product Part -->
    <h1 class="center">Gestion des Produits</h1>
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nom</th>
                    <th>Description</th>
                    <th>Prix</th>
                    <th>Stock</th>
                    <th>Category_id</th>
                </tr>
            </thead>
            <tbody>
                <?php
                    $product = getAllProducts();
                    foreach ($product as $product): 
                        if(isset($product['category_id'])){
                            switch ($product['category_id']) {
                                case '1':
                                        $productCategory = 'Fleur';
                                    break;
                                case '2':
                                        $productCategory = 'Table';
                                    break;
                                case '3':
                                        $productCategory = 'Velo';
                                    break;
                                default:
                        
                                    break;
                            }
                        }
                    ?>
                <tr>
                    <td>
                        <?= $product['product_id'] ?>
                    </td>
                    <td>
                        <?= $product['name'] ?>
                    </td>
                    <td>
                        <?= $product['description'] ?>
                    </td>
                    <td>
                        <?= $product['price'] ?>
                    </td>
                    <td>
                        <?= $product['stock'] ?>
                    </td>
                    <td>
                        <?= $productCategory ?>
                    </td>
                    <!-- <td>
                                    <a href="update_user.php?id=<?= $user['id'] ?>" class="btn-action btn-mod">Modifier</a>
                                    <a href="<?= URL; ?>controllers/userCrud/deleteUser.php?id=<?= $user['id'] ?>" class="btn-action btn-supp">Supprimer</a>
                                </td> -->
                </tr>
                <?php endforeach; ?>
            </tbody>
        </table>
    </div>

    <!-- Ajout Part -->
    <?php //include ('views\admin\productBO.php'); ?>
    <div class="container">

        <div class="form-container">
            <div class="form-wrapper">
                <h3 class="center"> Ajout product en base de donnée </h3>
                <form action="index.php?p=addProduct" class="" method="post">
                    <div class="user-box">
                        <input type="text" id="productName" name="productName" required="">
                        <label for="productName">Nom produit</label>
                    </div>
                    <div class="user-box">
                        <input type="text" id="productImage" name="productImage" required="">
                        <label for="productImage">Nom fichier image produit</label>
                    </div>
                    <div class="user-box">
                        <input type="text" id="productDescription" name="productDescription" required="">
                        <label for="productDescription">description produit</label>
                    </div>
                    <div class="user-box">
                        <input type="text" id="productPrice" name="productPrice" required="">
                        <label for="productPrice">Prix produit</label>
                    </div>

                    <div class="product-box">
                        <div class="radio-group">
                            <div class="radio-item">
                                <label for="fleur">Fleur</label>
                                <input type="radio" id="fleur" name="productCat" value="1" required>
                            </div>

                            <div class="radio-item">
                                <label for="table">Table</label>
                                <input type="radio" id="table" name="productCat" value="2">
                            </div>

                            <div class="radio-item">
                                <label for="velo">Velo</label>
                                <input type="radio" id="velo" name="productCat" value="3">
                            </div>
                        </div>
                    </div>

                    <div class="item-center">
                        <input type="submit" name="bouton" value="push" class="form-btn">
                    </div>
                </form>
            </div>
        </div>
    </div>

</div>

<?php
    $content = ob_get_clean(); //copie l'enregistrement dans la variable content
    $title = "Back Office";
    require('./views/layout/template-fontpage.php');
?>


<div class="cart-container">
    <h1>Mon Panier</h1>

    <?php if (empty($items)): ?>
    <p>Votre panier est vide.</p>
    <?php else: ?>
    <table class="cart-table">
        <thead>
            <tr>
                <th>Produit</th>
                <th>Qté</th>
                <th>Prix Unitaire</th>
                <th>Total</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            <?php $grandTotal = 0; ?>
            <?php foreach ($items as $item): ?>
            <tr>
                <td>
                    <?= htmlspecialchars($item['name']) ?>
                </td>
                <td>
                    <?= $item['quantity'] ?>
                </td>
                <td>
                    <?= number_format($item['price'], 2, ',', ' ') ?> €
                </td>
                <td>
                    <?= number_format($item['total'], 2, ',', ' ') ?> €
                </td>
                <td>
                    <a href="?p=removeFromCart&product_id=<?= $item['product_id'] ?>">Supprimer</a>
                </td>
            </tr>
            <?php $grandTotal += $item['total']; ?>
            <?php endforeach; ?>
        </tbody>
        <tfoot>
            <tr>
                <td colspan="3"><strong>Total général</strong></td>
                <td colspan="2"><strong>
                        <?= number_format($grandTotal, 2, ',', ' ') ?> €
                    </strong></td>
            </tr>
        </tfoot>
    </table>
    <?php endif; ?>

    <p><a href="?p=fleurs">Continuer mes achats</a></p>
</div>